# Kernel Bisection Configuration
# Copy this file to bisect.yaml in your bisection directory and customize
#
# Per-Directory Workflow:
# Each bisection case should have its own directory with:
#   - bisect.yaml (this config file)
#   - bisect.db (database, created automatically)
#
# Example:
#   mkdir ~/bisect-boot-issue
#   cd ~/bisect-boot-issue
#   cp /path/to/bisect.conf.example ./bisect.yaml
#   vim bisect.yaml  # customize
#   kbisect init v6.1 v6.6

# Slave machine configuration
slave:
  hostname: 192.168.1.100           # Slave machine IP or hostname
  ssh_user: root                     # SSH user for slave access
  kernel_path: /root/kernel          # Path to kernel source on slave
  bisect_path: /root/kernel-bisect/lib  # Path where bisect library will be deployed

# Kernel repository (optional - automatic repository deployment)
# If configured, the repository will be cloned/copied on master and transferred to slave
# This eliminates the need to manually clone the kernel source on the slave
kernel_repo:
  # Git repository URL or local filesystem path
  # Examples:
  #   - https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
  #   - https://github.com/torvalds/linux.git
  #   - /home/user/local-kernel-repo
  source: null

  # Optional: Branch or ref to checkout after clone
  # If not specified, uses repository's default branch
  # Examples: main, master, linux-6.6.y
  branch: null

# Deployment configuration (automatic slave setup)
# Note: Slave verification always happens before bisection
deployment:
  auto_deploy: true                  # Automatically deploy to slave if not set up

# IPMI configuration (for power control and recovery)
ipmi:
  host: 192.168.1.101               # IPMI interface IP
  username: admin                    # IPMI username
  password: changeme                 # IPMI password (use keyring in production)

# Timeouts (in seconds)
timeouts:
  boot: 300                          # Boot timeout
  test: 600                          # Test timeout
  build: 1800                        # Build timeout (30 minutes)

# Kernel configuration
kernel_config:
  # Path to base .config file (optional)
  # If not specified and use_running_config is false, kernel defaults are used
  config_file: null

  # Use running kernel's config as base (default: false)
  # If both config_file and use_running_config are set, config_file takes precedence
  use_running_config: false

# Test configuration
# Note: Current kernel is always protected and cannot be deleted during cleanup
# Boot test: Just checks if kernel boots successfully
# Custom test: Runs a custom test script after successful boot
test:
  type: boot                        # "boot" or "custom"
  # If type is "custom", specify script path:
  # script: /root/reproducers/my-test.sh

# State and Database (per-directory isolation)
# All bisection state and metadata stored in SQLite database
database_path: bisect.db            # SQLite database file (default: ./bisect.db)
state_dir: .                        # Working directory for database (default: current directory)

# Metadata collection
# Note: Compression is always enabled for efficient storage
# Note: Package counts are always included in baseline metadata
metadata:
  collect_baseline: true            # Collect system metadata at session start
  collect_per_iteration: true       # Collect kernel metadata per iteration
  collect_kernel_config: true       # Include kernel .config in metadata
  # All metadata stored in database (no filesystem files)

# Console log collection (boot process logs)
console_logs:
  enabled: false                    # Enable console log collection during boot
  collector: "auto"                 # "conserver" | "ipmi" | "auto"
  # Override hostname for console connection (default: slave hostname)
  hostname: null
  # Fall back to IPMI SOL if conserver fails
  fallback_to_ipmi: true
  # Console logs are stored in database (build_logs table, log_type="console")
  # View with: kbisect logs list --log-type console

# Application Logging
# Logs are printed to terminal (stdout/stderr)
# Use --verbose flag for DEBUG level output: kbisect --verbose start
# Build logs and console logs are stored in the database (see console_logs section above)
